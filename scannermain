loadstring(game:HttpGet("https://raw.githubusercontent.com/DeividComSono/DoorsRoblox/main/NotBlacklistCustomShop.lua"))()

_G.OnShop = true
_G.CreateItem("exampleTool", {
    Title       = "Scanner",
    Description = "on stock!1!!",
    Desc        = "on stock!1!!",
    Image       = "https://static.wikia.nocookie.net/doors-game/images/4/4e/Scanner_Icon.png/revision/latest/scale-to-width-down/350?cb=20230203191128",
    Price       = "1",  -- или число
    Stack       = true
})

local toolModel = game:GetObjects("rbxassetid://12594482248")[1]
local LocalPlayer = game.Players.LocalPlayer
local Backpack = LocalPlayer:WaitForChild("Backpack")

toolModel.Parent = Backpack:WaitForChild("Storage")

local ScannerModule = {}

local ViewNormal = Instance.new("Camera")
ViewNormal.Name = "ViewNormal"
ViewNormal.Parent = workspace.CurrentCamera
ViewNormal.FieldOfView = workspace.CurrentCamera.FieldOfView

local ViewSpecial = Instance.new("Camera")
ViewSpecial.Name = "ViewSpecial"
ViewSpecial.Parent = workspace.CurrentCamera

local TweenService = game:GetService("TweenService")
local equipAnimTime = tick()

local function equip()
    local Character = LocalPlayer.Character
    if not Character then return end
    
    print("scanner module: tool equipped!")
    
    local humanoid = Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        for _, animObj in pairs(toolModel:WaitForChild("Animations"):GetChildren()) do
            if animObj.Name == "equip" then
                local anim = humanoid:LoadAnimation(animObj)
                anim:Play()
            end
        end
    end
    
    local screenUI = toolModel:WaitForChild("ScreenUI")
    screenUI.Parent = LocalPlayer.PlayerGui
    screenUI.Enabled = true
    
    local handle = screenUI:WaitForChild("Handle")
    local screen = handle:WaitForChild("Screen")
    screen.Adornee = handle
    
    TweenService:Create(workspace.CurrentCamera, 
        TweenInfo.new(0.5, Enum.EasingStyle.Quart, Enum.EasingDirection.InOut),
        {FieldOfView = 70}
    ):Play()
end

local function fire()
    local currentRoom = workspace.CurrentRooms:FindFirstChild(workspace:GetAttribute("CurrentRoom"))
    if not currentRoom then return end
    
    ViewNormal:FindFirstChild("ViewNormal")  -- cleanup?
    
    for _, obj in pairs(currentRoom:GetDescendants()) do
        if obj:IsA("BasePart") and obj.Size.Magnitude < 20 then
            local clone = obj:Clone()
            clone.CanQuery = false
            clone.Parent = ViewSpecial
            clone.Anchored = true
            task.spawn(function()
                -- Подсветка для ключей/рычагов
                if obj.Name:find("KeyObtain") or obj.Name:find("LeverForGate") or 
                   obj.Name:find("LiveBreakerPolePickup") or obj.Name:find("LiveHintBook") then
                    clone.Size = clone.Size * 1.5
                    clone.Material = Enum.Material.ForceField
                    clone.BrickColor = BrickColor.new("Bright green")
                end
                wait(3)
                clone:Destroy()
            end)
        end
    end
    
    local scanSound = Instance.new("Sound")
    scanSound.SoundId = "rbxassetid://8681113666"
    scanSound.Volume = math.random(0.5, 0.8)
    scanSound.Parent = workspace
    scanSound:Play()
end

local function unequip()
    print("scanner module: tool unequipped!")
    
    local screenUI = LocalPlayer.PlayerGui:FindFirstChild("ScreenUI")
    if screenUI then
        screenUI.Enabled = false
    end
    
    -- Стоп анимаций
    for _, sound in pairs(toolModel:GetChildren()) do
        if sound:IsA("Sound") then sound:Stop() end
    end
end

toolModel.ChildAdded:Connect(function(child)
    if child:IsA("Tool") then
        local activatedConn, equippedConn, unequippedConn
        
        child.Activated:Connect(function()
            fire()
        end)
        
        child.Equipped:Connect(function()
            equip()
        end)
        
        child.Unequipped:Connect(function()
            unequip()
        end)
    end
end)

task.spawn(function()
    while true do
        wait(0.1)
        
        local screenUI = LocalPlayer.PlayerGui:FindFirstChild("ScreenUI")
        if screenUI and screenUI.Enabled then
            local handle = screenUI:WaitForChild("Handle")
            local screen = handle:WaitForChild("Screen")
            
            -- FOV наведения
            local currentRoom = workspace:GetAttribute("CurrentRoom")
            local room = workspace.CurrentRooms:FindFirstChild(tostring(currentRoom))
            
            pcall(function()
                warn("Scanning room:", currentRoom)
                task.wait(0.5)
                
                -- Направление луча
                local rayDir = workspace.CurrentCamera.CFrame.LookVector * 1000
                screen.CFrame = CFrame.lookAt(handle.Position, handle.Position + rayDir)
            end)
        end
    end
end)

local static1 = screenUI:FindFirstChild("Static1")
local static2 = screenUI:FindFirstChild("Static2")

static1.Position = UDim2.new(math.random(0,100)/100, 0, math.random(0,100)/100, 0)
static2.Position = UDim2.new(math.random(0,100)/100, 0, math.random(0,100)/100, 0)

local scanSounds = {
    "rbxassetid://8681113666",  -- v20 Static1
    "rbxassetid://8681113503"   -- v20 Static2
}
